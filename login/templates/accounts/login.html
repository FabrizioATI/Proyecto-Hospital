{% extends "accounts/base.html" %}
{% load static %}
{% block title %}Iniciar sesión{% endblock %}

{% block content %}

{% if login_error %}
<style>
  .toast-lite {
    position: fixed; top: 1rem; right: 1rem; z-index: 1080;
    min-width: 260px; max-width: 360px; color: #fff;
    background: #dc3545; /* rojo por defecto (error) */
    border-radius: 10px; padding: .75rem 1rem; box-shadow: 0 10px 30px rgba(0,0,0,.2);
    display: flex; align-items: center; gap: .75rem;
  }
  .toast-lite.warning { background: #fd7e14; } /* naranja (warning) */
  .toast-lite .close-x {
    margin-left: auto; background: transparent; border: none; color: #fff;
    font-size: 1.1rem; cursor: pointer;
  }
</style>

<div id="toastLite" class="toast-lite" role="status" aria-live="polite" aria-atomic="true">
  <span>{{ login_error }}</span>
  <button class="close-x" aria-label="Cerrar" onclick="document.getElementById('toastLite').remove()">×</button>
</div>

<script>
  setTimeout(function () {
    var t = document.getElementById('toastLite');
    if (t) t.remove();
  }, 3000); // autocierra en 3s
</script>
{% endif %}


<div class="soft-background">
    <div class="floating-shapes">
        <div class="soft-blob blob-1"></div>
        <div class="soft-blob blob-2"></div>
        <div class="soft-blob blob-3"></div>
        <div class="soft-blob blob-4"></div>
    </div>
</div>

<div class="login-container">
    <div class="soft-card">
        <div class="comfort-header">
            <div class="gentle-logo">
                <div class="logo-circle">
                    <div class="comfort-icon">
                        <img src="{% static 'assets/img/icon_app_white.png' %}" alt="logo" 
                             class="img-fluid" style="max-height: 60px; max-width: 270px;" />
                    </div>
                    <div class="gentle-glow"></div>
                </div>
            </div>
            <h1 class="comfort-title">¡Bienvenido!</h1>
            <p class="gentle-subtitle">Sistema de Gestión de Citas</p>
        </div>
        
        <!-- FORMULARIO LOGIN -->
        <form method="POST" action="{% url 'login' %}" class="comfort-form" id="loginForm" novalidate>
            {% csrf_token %}

            {% if messages %}
              <ul>
                {% for m in messages %}
                  <li>{{ m }}</li>
                {% endfor %}
              </ul>
            {% endif %}

            <!-- DNI -->
            <p class="gentle-subtitle" style="margin-left: 6px; margin-bottom: 5px;">DNI</p>
            <div class="soft-field">
                <div class="field-container">
                    <input type="text" id="dni" name="dni" required inputmode="numeric" pattern="\d*">
                    <div class="field-accent"></div>
                </div>
            </div>

            <!-- CONTRASEÑA -->
            <p class="gentle-subtitle" style="margin-left: 6px; margin-bottom: 5px;">Contraseña</p>
            <div class="soft-field">
                <div class="field-container">
                    <input type="password" id="contraseña" name="contraseña" required>
                    <button type="button" class="gentle-toggle" id="passwordToggle" aria-label="Toggle password visibility">
                        <div class="toggle-icon">
                            <svg class="eye-open" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M10 3c-4.5 0-8.3 3.8-9 7 .7 3.2 4.5 7 9 7s8.3-3.8 9-7c-.7-3.2-4.5-7-9-7z" 
                                      stroke="currentColor" stroke-width="1.5" fill="none"/>
                                <circle cx="10" cy="10" r="3" 
                                        stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                            <svg class="eye-closed" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M3 3l14 14M8.5 8.5a3 3 0 004 4m2.5-2.5C15 10 12.5 7 10 7c-.5 0-1 .1-1.5.3M10 13c-2.5 0-4.5-2-5-3 .3-.6.7-1.2 1.2-1.7" 
                                      stroke="currentColor" stroke-width="1.5" 
                                      stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </button>
                    <div class="field-accent"></div>
                </div>
            </div>

            <!-- BOTÓN -->
            <button type="submit" class="comfort-button">
                <div class="button-background"></div>
                <span class="button-text">Iniciar sesión</span>
                <div class="button-loader">
                    <div class="gentle-spinner">
                        <div class="spinner-circle"></div>
                    </div>
                </div>
                <div class="button-glow"></div>
            </button>
        </form>

        <div class="comfort-signup">
            <span class="signup-text">¿No tienes una cuenta?</span>
            <a href="{% url 'register' %}" class="comfort-link signup-link">Registrate</a>
        </div>
    </div>
</div>
{% endblock content %}
